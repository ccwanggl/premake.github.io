<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Premake RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Premake Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Premake" href="/opensearch.xml">
<script src="/js/localizeLastUpdatedDate.js" async defer="defer"></script><title data-react-helmet="true">Embedding Modules | Premake</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://premake.github.io//docs/Embedding-Modules"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Embedding Modules | Premake"><meta data-react-helmet="true" name="description" content="This section only applies if you want to embed your module into a custom build of Premake for easier distribution. If you&#x27;re not doing that, you can skip it."><meta data-react-helmet="true" property="og:description" content="This section only applies if you want to embed your module into a custom build of Premake for easier distribution. If you&#x27;re not doing that, you can skip it."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://premake.github.io//docs/Embedding-Modules"><link data-react-helmet="true" rel="alternate" href="https://premake.github.io//docs/Embedding-Modules" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://premake.github.io//docs/Embedding-Modules" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BZ59R9HF86-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.2a2ca7d7.css">
<link rel="preload" href="/assets/js/runtime~main.6d8db442.js" as="script">
<link rel="preload" href="/assets/js/main.f32b0baa.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/premake-logo.png" alt="Premake Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/premake-logo.png" alt="Premake Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Premake</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">News</a><a class="navbar__item navbar__link" href="/community/support">Community</a></div><div class="navbar__items navbar__items--right"><a href="https://twitter.com/premakeapp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fa fa-twitter fa-2x" aria-label="Premake on Twitter"></a><a href="https://github.com/premake/premake-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fa fa-github fa-2x" aria-label="GitHub repository"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><main class="docMainContainer_r8cw docMainContainerEnhanced_SOUu"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Embedding Modules</h1></header><p><em>This section only applies if you want to embed your module into a custom build of Premake for easier distribution. If you&#x27;re not doing that, you can skip it.</em></p><p>Premake includes a number of modules as part of the official builds, with more being added regularly. These modules are embedded directly into Premake along with the core scripts to enable easy distribution of a single, self-contained executable.</p><p>If you are creating a custom build of Premake, you can easily embed your own modules by following the instructions below. Also take a look at Premake&#x27;s own set of modules in the <code>modules/</code> folder for some real working examples.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="1-put-your-module-where-premake-can-find-it">1. Put your module where Premake can find it.<a aria-hidden="true" class="hash-link" href="#1-put-your-module-where-premake-can-find-it" title="Direct link to heading">â€‹</a></h4><p>Premake&#x27;s embedding system only considers scripts which are in Premake source code tree, so the first step is to put your module where it can be found. Premake&#x27;s own modules are stored in the <code>modules/</code> folder.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-add-a-manifest">2. Add a manifest<a aria-hidden="true" class="hash-link" href="#2-add-a-manifest" title="Direct link to heading">â€‹</a></h4><p>Premake needs to know which scripts it should embed, and which it should ignore (tests, etc.). Create a file named <code>_manifest.lua</code> which returns an array file names to be loaded. For example, Premake&#x27;s Xcode module manifest looks like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI lua"><pre tabindex="0" class="prism-code language-lua codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">return {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;_preload.lua&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;xcode.lua&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;xcode4_workspace.lua&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;xcode_common.lua&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;xcode_project.lua&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="3-add-an-optional-preload-script">3. Add an (optional) preload script<a aria-hidden="true" class="hash-link" href="#3-add-an-optional-preload-script" title="Direct link to heading">â€‹</a></h4><p>As more modules get added, Premake has to do more and more work on startup to evaluate all of those script files. To help minimize that work, modules should try to defer loading until they are actually needed by the project being generated.</p><p>On startup, Premake will check each embedded module for script named <code>_preload.lua</code>. If present, Premake will run that script, and defer loading the rest of the module. After the project script has had a chance to run, Premake will then ask the module if it needs to be loaded and, if so, load it before continuing. If no <code>_preload.lua</code> script is present, the module will be fully loaded immediately on startup.</p><p>To enable this, create a file named <code>_preload.lua</code> (be sure to also add it to your manifest). Move any settings or values that might be required by a project scriptâ€”new actions, command line options, or project API calls or allowed valuesâ€”out of your module to this file. At the very end of the script, return a function which determines whether the module can be loaded or not.</p><p>Here is a subset of the <code>_preload.lua</code> script from Premake&#x27;s Xcode module:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI lua"><pre tabindex="0" class="prism-code language-lua codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    local p = premake</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Register the Xcode action.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    newaction {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        trigger     = &quot;xcode4&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        shortname   = &quot;Apple Xcode 4&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        description = &quot;Generate Apple Xcode 4 project files&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        -- â€¦</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Decide when the full module should be loaded.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return function(cfg)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return (_ACTION == &quot;xcode4&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>It starts by registering the Xcode action; this allows the action to be used on the command line and appear in Premake&#x27;s help text, even though the full module has not yet been loaded. It then returns a test function to decide when the module should be loaded: in this case, when the user requests the &quot;xcode4&quot; action on the command line.</p><p>In the case of a new action, the test function&#x27;s configuration argument is ignored. In Premake&#x27;s D language module, it should only load if one of the project&#x27;s specified in the user scripts wants to use the D language.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI lua"><pre tabindex="0" class="prism-code language-lua codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">return function(cfg)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return (cfg.language == &quot;D&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-tell-premake-to-load-your-module">4. Tell Premake to load your module<a aria-hidden="true" class="hash-link" href="#4-tell-premake-to-load-your-module" title="Direct link to heading">â€‹</a></h4><p>If you would like your module loaded (or pre-loaded) on startup, you must add it to the list in <code>src/_modules.lua</code>. Modules in this list can be used by project scripts without having to first <code>require()</code> them.</p><p>Modules that are not in this list are still embedded and may still be used by calling <code>require()</code>.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="5-embed-and-rebuild">5. Embed and rebuild<a aria-hidden="true" class="hash-link" href="#5-embed-and-rebuild" title="Direct link to heading">â€‹</a></h4><p>The final step is run Premake&#x27;s embedding script (<code>premake5 embed</code>) and then rebuild the Premake executable.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/premake/premake-core/edit/master/website/docs/Embedding-Modules.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-03-29T20:18:54.000Z">3/29/2021</time></b> by <b>starkos</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/What-Is-Premake">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Your-First-Script">Your First Script</a></li><li class="footer__item"><a href="https://github.com/premake/premake-4.x/wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">Premake 4.x</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/premake/premake-core/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/premake" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/community/support">Help</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/premake/premake-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/premakeapp" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opencollective.com/premake" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>OpenCollective<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 Premake</div></div></div></footer></div>
<script src="/assets/js/runtime~main.6d8db442.js"></script>
<script src="/assets/js/main.f32b0baa.js"></script>
</body>
</html>