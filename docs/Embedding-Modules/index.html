<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Premake Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Premake Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Premake" href="/opensearch.xml">
<script src="https://use.fontawesome.com/dd1c9cd9ff.js"></script><title data-react-helmet="true">Embedding Modules | Premake</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Embedding Modules | Premake"><meta data-react-helmet="true" name="description" content="This section only applies if you want to embed your module into a custom build of Premake for easier distribution. If you&#x27;re not doing that, you can skip it."><meta data-react-helmet="true" property="og:description" content="This section only applies if you want to embed your module into a custom build of Premake for easier distribution. If you&#x27;re not doing that, you can skip it."><meta data-react-helmet="true" property="og:url" content="https://premake.github.io//docs/Embedding-Modules"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://premake.github.io//docs/Embedding-Modules"><link rel="stylesheet" href="/styles.3798bacf.css">
<link rel="preload" href="/styles.7bb090ac.js" as="script">
<link rel="preload" href="/runtime~main.b2d36da4.js" as="script">
<link rel="preload" href="/main.4a398cd7.js" as="script">
<link rel="preload" href="/1.116e5d7c.js" as="script">
<link rel="preload" href="/2.8a45cf29.js" as="script">
<link rel="preload" href="/371.5fbca094.js" as="script">
<link rel="preload" href="/374.33f22a5c.js" as="script">
<link rel="preload" href="/935f2afb.aba8e5c3.js" as="script">
<link rel="preload" href="/17896441.8855ae71.js" as="script">
<link rel="preload" href="/cfe26f3c.ffc818c8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/premake-logo.png" alt="Premake Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/premake-logo.png" alt="Premake Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Premake</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">News</a><a class="navbar__item navbar__link" href="/community/support">Community</a></div><div class="navbar__items navbar__items--right"><a href="https://twitter.com/premakeapp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fa fa-twitter fa-2x" aria-label="Premake on Twitter"></a><a href="https://github.com/premake/premake-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fa fa-github fa-2x" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/premake-logo.png" alt="Premake Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/premake-logo.png" alt="Premake Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Premake</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">News</a></li><li class="menu__list-item"><a class="menu__link" href="/community/support">Community</a></li><li class="menu__list-item"><a href="https://twitter.com/premakeapp" target="_blank" rel="noopener noreferrer" class="menu__link fa fa-twitter fa-2x" aria-label="Premake on Twitter"></a></li><li class="menu__list-item"><a href="https://github.com/premake/premake-core" target="_blank" rel="noopener noreferrer" class="menu__link fa fa-github fa-2x" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Embedding Modules</h1></header><div class="markdown"><p><em>This section only applies if you want to embed your module into a custom build of Premake for easier distribution. If you&#x27;re not doing that, you can skip it.</em></p><p>Premake includes a number of modules as part of the official builds, with more being added regularly. These modules are embedded directly into Premake along with the core scripts to enable easy distribution of a single, self-contained executable.</p><p>If you are creating a custom build of Premake, you can easily embed your own modules by following the instructions below. Also take a look at Premake&#x27;s own set of modules in the <code>modules/</code> folder for some real working examples.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="1-put-your-module-where-premake-can-find-it"></a>1. Put your module where Premake can find it.<a class="hash-link" href="#1-put-your-module-where-premake-can-find-it" title="Direct link to heading">#</a></h4><p>Premake&#x27;s embedding system only considers scripts which are in Premake source code tree, so the first step is to put your module where it can be found. Premake&#x27;s own modules are stored in the <code>modules/</code> folder.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="2-add-a-manifest"></a>2. Add a manifest<a class="hash-link" href="#2-add-a-manifest" title="Direct link to heading">#</a></h4><p>Premake needs to know which scripts it should embed, and which it should ignore (tests, etc.). Create a file named <code>_manifest.lua</code> which returns an array file names to be loaded. For example, Premake&#x27;s Xcode module manifest looks like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lua codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">return {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;_preload.lua&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;xcode.lua&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;xcode4_workspace.lua&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;xcode_common.lua&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;xcode_project.lua&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="3-add-an-optional-preload-script"></a>3. Add an (optional) preload script<a class="hash-link" href="#3-add-an-optional-preload-script" title="Direct link to heading">#</a></h4><p>As more modules get added, Premake has to do more and more work on startup to evaluate all of those script files. To help minimize that work, modules should try to defer loading until they are actually needed by the project being generated.</p><p>On startup, Premake will check each embedded module for script named <code>_preload.lua</code>. If present, Premake will run that script, and defer loading the rest of the module. After the project script has had a chance to run, Premake will then ask the module if it needs to be loaded and, if so, load it before continuing. If no <code>_preload.lua</code> script is present, the module will be fully loaded immediately on startup.</p><p>To enable this, create a file named <code>_preload.lua</code> (be sure to also add it to your manifest). Move any settings or values that might be required by a project scriptâ€”new actions, command line options, or project API calls or allowed valuesâ€”out of your module to this file. At the very end of the script, return a function which determines whether the module can be loaded or not.</p><p>Here is a subset of the <code>_preload.lua</code> script from Premake&#x27;s Xcode module:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lua codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    local p = premake</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- Register the Xcode action.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    newaction {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        trigger     = &quot;xcode4&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        shortname   = &quot;Apple Xcode 4&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        description = &quot;Generate Apple Xcode 4 project files&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        -- â€¦</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- Decide when the full module should be loaded.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return function(cfg)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return (_ACTION == &quot;xcode4&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>It starts by registering the Xcode action; this allows the action to be used on the command line and appear in Premake&#x27;s help text, even though the full module has not yet been loaded. It then returns a test function to decide when the module should be loaded: in this case, when the user requests the &quot;xcode4&quot; action on the command line.</p><p>In the case of a new action, the test function&#x27;s configuration argument is ignored. In Premake&#x27;s D language module, it should only load if one of the project&#x27;s specified in the user scripts wants to use the D language.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lua codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">return function(cfg)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return (cfg.language == &quot;D&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="4-tell-premake-to-load-your-module"></a>4. Tell Premake to load your module<a class="hash-link" href="#4-tell-premake-to-load-your-module" title="Direct link to heading">#</a></h4><p>If you would like your module loaded (or pre-loaded) on startup, you must add it to the list in <code>src/_modules.lua</code>. Modules in this list can be used by project scripts without having to first <code>require()</code> them.</p><p>Modules that are not in this list are still embedded and may still be used by calling <code>require()</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="5-embed-and-rebuild"></a>5. Embed and rebuild<a class="hash-link" href="#5-embed-and-rebuild" title="Direct link to heading">#</a></h4><p>The final step is run Premake&#x27;s embedding script (<code>premake5 embed</code>) and then rebuild the Premake executable.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/premake/premake-core/edit/master/website/docs/Embedding-Modules.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-04-13T14:28:59.000Z" class="docLastUpdatedAt_1Qna">4/13/2021</time> by <strong>starkos</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/What-Is-Premake">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Your-First-Script">Your First Script</a></li><li class="footer__item"><a href="https://github.com/premake/premake-4.x/wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">Premake 4.x</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/premake/premake-core/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/premake" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a class="footer__link-item" href="/community/support">Help</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/premake/premake-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/premakeapp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://opencollective.com/premake" target="_blank" rel="noopener noreferrer" class="footer__link-item">OpenCollective</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Premake</div></div></div></footer></div>
<script src="/styles.7bb090ac.js"></script>
<script src="/runtime~main.b2d36da4.js"></script>
<script src="/main.4a398cd7.js"></script>
<script src="/1.116e5d7c.js"></script>
<script src="/2.8a45cf29.js"></script>
<script src="/371.5fbca094.js"></script>
<script src="/374.33f22a5c.js"></script>
<script src="/935f2afb.aba8e5c3.js"></script>
<script src="/17896441.8855ae71.js"></script>
<script src="/cfe26f3c.ffc818c8.js"></script>
</body>
</html>