"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[4835],{19419:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var a=t(74848),s=t(28453);const r={title:"Generating Project Files"},o=void 0,i={id:"Generating-Project-Files",title:"Generating Project Files",description:"Now let's extend our new action to actually output some workspace and project files so we can begin to get a sense for how things work.",source:"@site/docs/Generating-Project-Files.md",sourceDirName:".",slug:"/Generating-Project-Files",permalink:"/docs/Generating-Project-Files",draft:!1,unlisted:!1,editUrl:"https://github.com/premake/premake-core/edit/master/website/docs/Generating-Project-Files.md",tags:[],version:"current",lastUpdatedBy:"starkos",lastUpdatedAt:1615992656e3,frontMatter:{title:"Generating Project Files"}},c={},l=[{value:"Creating the Files",id:"creating-the-files",level:2},{value:"Populating the Workspace",id:"populating-the-workspace",level:2},{value:"Populating the Project",id:"populating-the-project",level:2},{value:"Escapes and Indents and EOLs",id:"escapes-and-indents-and-eols",level:2}];function p(e){const n={a:"a",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"Now let's extend our new action to actually output some workspace and project files so we can begin to get a sense for how things work."}),"\n",(0,a.jsx)(n.p,{children:"First we need to know what we want to generate. Let's start with a very simple Premake project script, then we'll figure out how we want it to appear when we translate it to Lua."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'workspace "Greetings"\n\tconfigurations { "Debug", "Release" }\n\nproject "HelloApp"\n\tkind "ConsoleApp"\n\tlanguage "C++"\n\tfiles { "hello.h", "hello.cpp" }\n'})}),"\n",(0,a.jsxs)(n.p,{children:["There are, of course, many ways we could express this in Lua. For the purposes of this tutorial, we'll start by creating two files, starting with ",(0,a.jsx)(n.code,{children:"Greetings.wks.lua"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'workspace = {\n\tname = "Greetings",\n\tprojects = {\n\t\t["HelloApp"] = {\n\t\t\tpath = "HelloApp.prj.lua",\n\t\t},\n\t},\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Workspaces generally are used to manage a list of projects, so we'll try to do the same with our Lua version."}),"\n",(0,a.jsxs)(n.p,{children:["We'll also generate a second file named ",(0,a.jsx)(n.code,{children:"HelloApp.prj.lua"}),", containing some of the easily accessible project information."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'project = {\n\tname = "MyConsoleApp",\n\tuuid = "B19F86AA-524E-4260-B200-243C70F2DA04",\n\tkind = "ConsoleApp",\n\tlanguage = "C++",\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"This is just to get things started; we'll come back to the configurations and the source code files and all of the other settings later."}),"\n",(0,a.jsx)(n.h2,{id:"creating-the-files",children:"Creating the Files"}),"\n",(0,a.jsxs)(n.p,{children:["Creating these files is easy: Premake has a built-in function to do just that, which we can leverage in our action's ",(0,a.jsx)(n.code,{children:"onWorkspace()"})," and ",(0,a.jsx)(n.code,{children:"onProject()"})," callbacks."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'-- lua/lua.lua\n\npremake.modules.lua = {}\nlocal m = premake.modules.lua\n\nlocal p = premake\n\nnewaction {\n\ttrigger = "lua",\n\tdescription = "Export project information as Lua",\n\n\tonStart = function ()\n\tend,\n\n\t-- create a new file with a ".wks.lua" extension and\n\t-- then call our generateWorkspace() function.\n\tonWorkspace = function(wks)\n\t\tp.generate(wks, ".wks.lua", m.generateWorkspace)\n\tend,\n\n\t-- create a new file with a ".prj.lua" extension and\n\t-- then call our generateProject() function.\n\tonProject = function(prj)\n\t\tp.generate(prj, ".prj.lua", m.generateProject)\n\tend,\n}\n\n\nfunction m.generateWorkspace(wks)\n\tp.w(\'This is a Lua "workspace" file.\')\nend\n\n\nfunction m.generateProject(prj)\n\tp.w(\'This is a Lua "project" file.\')\nend\n\n\nreturn m\n'})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"premake.generate()"})," function uses the information contained in the workspace or project to figure out the right name of location for the file, and then creates it on the disk. Once the file has been successfully created and opened, it then calls the function we provide as the last argument in the call (",(0,a.jsx)(n.code,{children:"generateWorkspace()"})," and ",(0,a.jsx)(n.code,{children:"generateProject()"})," respectively) and passes it the corresponding workspace or project object to be exported."]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"p.w()"}),' function, which stands for "Premake write", simply outputs a text string to the currently open file. You\'ll be seeing much more of this one.']}),"\n",(0,a.jsxs)(n.p,{children:["If you go ahead and generate that project (i.e. run ",(0,a.jsx)(n.code,{children:"premake5 lua"}),' again), you will see the files get created on disk, each containing the corresponding "This is a..." message.']}),"\n",(0,a.jsx)(n.h2,{id:"populating-the-workspace",children:"Populating the Workspace"}),"\n",(0,a.jsx)(n.p,{children:"Now we can begin to fill in our workspace and project files. Let's begin with the easy parts of the workspace."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:"function m.generateWorkspace(wks)\n\tp.push('workspace = {')\n\tp.w('name = \"%s\",', wks.name)\n\n\tp.push('projects = {')\n\tp.pop('},')\n\n\tp.pop('}')\nend\n"})}),"\n",(0,a.jsxs)(n.p,{children:["A couple of new functions here: ",(0,a.jsx)(n.code,{children:"p.push()"})," writes the provided string to the output file, and increments an internal indentation level. ",(0,a.jsx)(n.code,{children:"p.pop()"})," decrements the indentation level, and then writes its provided string to the output. ",(0,a.jsx)(n.code,{children:"p.w()"}),", which we saw earlier, outputs its string at the current indentation level as set by ",(0,a.jsx)(n.code,{children:"push()"})," and ",(0,a.jsx)(n.code,{children:"pop()"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"So between all that pushing and popping, we end up with a nicely indented workspace file with an empty list of projects."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'workspace = {\n\tname = "Greetings",\n\tprojects = {\n\t},\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Let's tackle that project list next. Premake has an entire API for working with workspaces, which you can find by browsing the ",(0,a.jsx)(n.a,{href:"https://github.com/premake/premake-core/blob/master/src/base/workspace.lua",children:"src/base/workspace.lua"})," script in Premake's source code."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.em,{children:"(Coming soon, just need to make a few code changes...)"})}),"\n",(0,a.jsx)(n.h2,{id:"populating-the-project",children:"Populating the Project"}),"\n",(0,a.jsx)(n.p,{children:"Since we're only exporting a few of the simple fields, generating our project file is quite easy:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:"function m.generateProject(prj)\n\tp.push('project = {')\n\tp.w('name = \"%s\",', prj.name)\n\tp.w('uuid = \"%s\",', prj.uuid)\n\tp.w('kind = \"%s\"', prj.kind)\n\tp.pop('}')\nend\n"})}),"\n",(0,a.jsx)(n.p,{children:"Which gives us a project file like:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'project = {\n\tname = "MyConsoleApp",\n\tuuid = "B19F86AA-524E-4260-B200-243C70F2DA04",\n\tkind = "ConsoleApp",\n\tlanguage = "C++",\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"escapes-and-indents-and-eols",children:"Escapes and Indents and EOLs"}),"\n",(0,a.jsx)(n.p,{children:"For the sake of completeness, a few last points."}),"\n",(0,a.jsxs)(n.p,{children:["First, indentation. By default, Premake will uses tab characters to indent the output. If your target format uses a different character sequence, two spaces for instances, you can adjust that using Premake's ",(0,a.jsx)(n.code,{children:"p.indent()"})," function."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'p.indent("  ")\n'})}),"\n",(0,a.jsxs)(n.p,{children:['Similarly, Premake will output Unix-style "\\n" line endings by default, which can be changed with the ',(0,a.jsx)(n.code,{children:"p.eol()"})," function."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'p.eol("\\r\\n")\n'})}),"\n",(0,a.jsxs)(n.p,{children:["If you wish to change these values for both your generated workspaces and projects, you can place them in your action's ",(0,a.jsx)(n.code,{children:"onStart()"})," function. If the values are different between workspaces and projects, put then in ",(0,a.jsx)(n.code,{children:"onWorkspace()"})," and ",(0,a.jsx)(n.code,{children:"onProject()"})," instead."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'onStart = function()\n\tp.indent("  ")\n\tp.eol("\\r\\n")\nend\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Finally, before we go we should consider string escaping. If, for example, someone were to name their project ",(0,a.jsx)(n.code,{children:'Joe\'s "Lucky" Diner'}),", we would try to generate this Lua script..."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'\tname = "Joe\'s "Lucky" Diner",\n'})}),"\n",(0,a.jsx)(n.p,{children:"...which would fail to load in a Lua interpreter, since the double quotes aren't properly matched. Instead, we ought to be generating:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'\tname = "Joe\'s \\"Lucky\\" Diner",\n'})}),"\n",(0,a.jsx)(n.p,{children:'Premake allows exporters to define an "escaper", a function which is used to transform values before they are written to the output. For our Lua exporter, we want to escape those double quotes with a backslash, and we should also escape backslashes while we\'re at it, which we can do by adding this function to our module:'}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:"function m.esc(value)\n\tvalue = value:gsub('\\\\', '\\\\\\\\')\n\tvalue = value:gsub('\"', '\\\\\"')\n\treturn value\nend\n"})}),"\n",(0,a.jsxs)(n.p,{children:["We can then tell Premake to use this function for both our workspaces and our project by registering our escaper in our action's ",(0,a.jsx)(n.code,{children:"onStart()"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:"onStart = function()\n\tp.escaper(m.escaper)\nend\n"})}),"\n",(0,a.jsxs)(n.p,{children:["One more step: since we don't ",(0,a.jsx)(n.em,{children:"always"})," want to escape values, Premake provides a separate call ",(0,a.jsx)(n.code,{children:"p.x()"})," for those times when we do. For our example case, we really only need to worry about the workspace and solution names right now, since the other fields are limited to values which do not contain special characters (while there is no harm in using ",(0,a.jsx)(n.code,{children:"p.x()"})," on values that do not contain special characters, there is a small performance hit which can add up for large projects)."]}),"\n",(0,a.jsx)(n.p,{children:"So our final script looks like this:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:"-- lua/lua.lua\n\npremake.modules.lua = {}\nlocal m = premake.modules.lua\n\nlocal p = premake\n\nnewaction {\n\ttrigger = \"lua\",\n\tdescription = \"Export project information as Lua\",\n\n\tonStart = function ()\n\t\tp.escaper(m.esc)\n\tend,\n\n\tonWorkspace = function(wks)\n\t\tp.generate(wks, \".wks.lua\", m.generateWorkspace)\n\tend,\n\n\tonProject = function(prj)\n\t\tp.generate(prj, \".prj.lua\", m.generateProject)\n\tend,\n}\n\n\nfunction m.generateWorkspace(wks)\n\tp.push('workspace = {')\n\tp.x('name = \"%s\",', wks.name)\n\n\tp.push('projects = {')\n\tp.pop('},')\n\n\tp.pop('}')\nend\n\n\nfunction m.generateProject(prj)\n\tp.push('project = {')\n\tp.x('name = \"%s\",', prj.name)\n\tp.w('uuid = \"%s\",', prj.uuid)\n\tp.w('kind = \"%s\"', prj.kind)\n\tp.pop('}')\nend\n\n\nfunction m.esc(value)\n\tvalue = value:gsub('\\\\', '\\\\\\\\')\n\tvalue = value:gsub('\"', '\\\\\"')\n\treturn value\nend\n\n\nreturn m\n"})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var a=t(96540);const s={},r=a.createContext(s);function o(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);